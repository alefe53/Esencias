<!DOCTYPE html>
<html lang="es">
<head>
    <%- include('partials/head', {
        pageTitle: (typeof banda !== 'undefined' && banda && banda.nombre) ? banda.nombre : 'Detalle de Banda',
        cssFile: '/css/music.conadf.band.css'
    }) %>
</head>
<body>

    <div class="back-button-container-detail">
        <a href="/music/musicconadf" class="back-button-detail">‹ Volver a Bandas</a>
    </div>

    <div class="band-detail-container">

        <% if (typeof banda !== 'undefined' && banda) { %>

            <%- include('partials/band_header', { banda: banda }) %>

            <% if (typeof banda.imagenesextra !== 'undefined' && Array.isArray(banda.imagenesextra) && banda.imagenesextra.length > 0) { %>
                <div class="gallery-button-container">
                    <button id="openGalleryBtn" class="gallery-button">Galeria de Fotos</button>
                </div>
            <% } %>

            <% if (typeof banda.youtubeVideoId !== 'undefined' && banda.youtubeVideoId && banda.youtubeVideoId.trim() !== '') { %>
                <%- include('partials/youtube_bandvideosection', { banda: banda }) %>
            <% } %>

            <%# Nuevo contenedor para poner Lanzamientos e Instagram lado a lado %>
            <%
                // Variable para verificar si hay links de Instagram REALMENTE MOSTRABLES
                const hasActualInstagramContent = typeof banda.linksinstagram !== 'undefined' &&
                                                  Array.isArray(banda.linksinstagram) &&
                                                  banda.linksinstagram.some(link => typeof link === 'string' && link.trim() !== '');
            %>
            <div class="lanzamientos-instagram-grid">

                <%# Columna de Lanzamientos %>
                <%# Añadimos la clase 'lanzamientos-column-full-width' si no hay contenido real de Instagram %>
                <div class="lanzamientos-column<%= !hasActualInstagramContent ? ' lanzamientos-column-full-width' : '' %>">
                    <% if (typeof banda.lanzamientos !== 'undefined' && Array.isArray(banda.lanzamientos) && banda.lanzamientos.length > 0) { %>
                        <section class="band-lanzamientos-section">
                            <h2>Lanzamientos de <%= banda.nombre %></h2>
                            <% banda.lanzamientos.forEach(function(lanzamiento) { %>
                                <% if (typeof lanzamiento !== 'undefined' && lanzamiento) { %>
                                    <%- include('partials/lanzamiento_item', { lanzamiento: lanzamiento }) %>
                                <% } %>
                            <% }); %>
                        </section>
                    <% } else { %>
                        <p class="no-lanzamientos-message">Esta banda aún no tiene lanzamientos registrados.</p>
                    <% } %>
                </div>

                <%# Columna de Instagram: solo se renderiza si hay contenido real de Instagram %>
                <% if (hasActualInstagramContent) { %>
                    <div class="instagram-column">
                        <%# El parcial instagram_embeds.ejs ya filtra internamente los links vacíos, %>
                        <%# pero aquí controlamos la renderización de toda la columna. %>
                        <%- include('partials/instagram_embeds', { links: banda.linksinstagram }) %>
                    </div>
                <% } %>

            </div> <%# Fin de lanzamientos-instagram-grid %>

        <% } else { %>
            <p class="error-message">No se pudo cargar la información de la banda.</p>
        <% } %>
    </div>

    <%- include('partials/image_modal') %>

    <% if (typeof banda !== 'undefined' && banda && typeof banda.imagenesextra !== 'undefined' && Array.isArray(banda.imagenesextra) && banda.imagenesextra.length > 0) { %>
        <%- include('partials/gallery_lightbox', { banda: banda }) %>
    <% } %>

   <script src="/js/band_detail_logic.js" defer></script>
</body>
</html>
